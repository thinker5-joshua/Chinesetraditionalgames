const fs = require('fs');

// 读取原始数据
const hexagramsData = JSON.parse(fs.readFileSync('hexagramsFullData.json', 'utf8'));

// 卦名到ID的映射
const nameToIdMap = {
    '乾': 1,
    '坤': 2,
    '屯': 3,
    '蒙': 4,
    '需': 5,
    '讼': 6,
    '师': 7,
    '比': 8,
    '小畜': 9,
    '履': 10,
    '泰': 11,
    '否': 12,
    '同人': 13,
    '大有': 14,
    '谦': 15,
    '豫': 16,
    '随': 17,
    '蛊': 18,
    '临': 19,
    '观': 20,
    '噬嗑': 21,
    '贲': 22,
    '剥': 23,
    '复': 24,
    '无妄': 25,
    '大畜': 26,
    '颐': 27,
    '大过': 28,
    '坎': 29,
    '离': 30,
    '咸': 31,
    '恒': 32,
    '遁': 33,
    '大壮': 34,
    '晋': 35,
    '明夷': 36,
    '家人': 37,
    '睽': 38,
    '蹇': 39,
    '解': 40,
    '损': 41,
    '益': 42,
    '夬': 43,
    '姤': 44,
    '萃': 45,
    '升': 46,
    '困': 47,
    '井': 48,
    '革': 49,
    '鼎': 50,
    '震': 51,
    '艮': 52,
    '渐': 53,
    '归妹': 54,
    '丰': 55,
    '旅': 56,
    '巽': 57,
    '兑': 58,
    '涣': 59,
    '节': 60,
    '中孚': 61,
    '小过': 62,
    '既济': 63,
    '未济': 64
};

// 用户提供的互卦、综卦、错卦数据
const relatedHexagramsData = [
    {"本卦": "乾", "互卦": "乾", "综卦": "乾", "错卦": "坤"},
    {"本卦": "坤", "互卦": "坤", "综卦": "坤", "错卦": "乾"},
    {"本卦": "屯", "互卦": "剥", "综卦": "蒙", "错卦": "蒙"},
    {"本卦": "蒙", "互卦": "复", "综卦": "屯", "错卦": "屯"},
    {"本卦": "需", "互卦": "大过", "综卦": "讼", "错卦": "晋"},
    {"本卦": "讼", "互卦": "大过", "综卦": "需", "错卦": "明夷"},
    {"本卦": "师", "互卦": "复", "综卦": "比", "错卦": "同人"},
    {"本卦": "比", "互卦": "剥", "综卦": "师", "错卦": "大有"},
    {"本卦": "小畜", "互卦": "大过", "综卦": "履", "错卦": "大畜"},
    {"本卦": "履", "互卦": "夬", "综卦": "小畜", "错卦": "谦"},
    {"本卦": "泰", "互卦": "坤", "综卦": "否", "错卦": "否"},
    {"本卦": "否", "互卦": "乾", "综卦": "泰", "错卦": "泰"},
    {"本卦": "同人", "互卦": "乾", "综卦": "大有", "错卦": "师"},
    {"本卦": "大有", "互卦": "乾", "综卦": "同人", "错卦": "比"},
    {"本卦": "谦", "互卦": "师", "综卦": "豫", "错卦": "蹇"},
    {"本卦": "豫", "互卦": "比", "综卦": "谦", "错卦": "解"},
    {"本卦": "随", "互卦": "渐", "综卦": "蛊", "错卦": "蛊"},
    {"本卦": "蛊", "互卦": "归妹", "综卦": "随", "错卦": "随"},
    {"本卦": "临", "互卦": "复", "综卦": "观", "错卦": "观"},
    {"本卦": "观", "互卦": "剥", "综卦": "临", "错卦": "临"},
    {"本卦": "噬嗑", "互卦": "蹇", "综卦": "贲", "错卦": "贲"},
    {"本卦": "贲", "互卦": "解", "综卦": "噬嗑", "错卦": "噬嗑"},
    {"本卦": "剥", "互卦": "坤", "综卦": "复", "错卦": "复"},
    {"本卦": "复", "互卦": "坤", "综卦": "剥", "错卦": "剥"},
    {"本卦": "无妄", "互卦": "师", "综卦": "大畜", "错卦": "大畜"},
    {"本卦": "大畜", "互卦": "比", "综卦": "无妄", "错卦": "无妄"},
    {"本卦": "颐", "互卦": "坤", "综卦": "颐", "错卦": "大过"},
    {"本卦": "大过", "互卦": "乾", "综卦": "大过", "错卦": "颐"},
    {"本卦": "坎", "互卦": "坎", "综卦": "坎", "错卦": "离"},
    {"本卦": "离", "互卦": "离", "综卦": "离", "错卦": "坎"},
    {"本卦": "咸", "互卦": "夬", "综卦": "恒", "错卦": "恒"},
    {"本卦": "恒", "互卦": "姤", "综卦": "咸", "错卦": "咸"},
    {"本卦": "遁", "互卦": "大过", "综卦": "大壮", "错卦": "大壮"},
    {"本卦": "大壮", "互卦": "夬", "综卦": "遁", "错卦": "遁"},
    {"本卦": "晋", "互卦": "蹇", "综卦": "明夷", "错卦": "需"},
    {"本卦": "明夷", "互卦": "解", "综卦": "晋", "错卦": "讼"},
    {"本卦": "家人", "互卦": "未济", "综卦": "睽", "错卦": "睽"},
    {"本卦": "睽", "互卦": "既济", "综卦": "家人", "错卦": "家人"},
    {"本卦": "蹇", "互卦": "未济", "综卦": "解", "错卦": "谦"},
    {"本卦": "解", "互卦": "既济", "综卦": "蹇", "错卦": "豫"},
    {"本卦": "损", "互卦": "复", "综卦": "益", "错卦": "益"},
    {"本卦": "益", "互卦": "剥", "综卦": "损", "错卦": "损"},
    {"本卦": "夬", "互卦": "乾", "综卦": "姤", "错卦": "姤"},
    {"本卦": "姤", "互卦": "乾", "综卦": "夬", "错卦": "夬"},
    {"本卦": "萃", "互卦": "巽", "综卦": "升", "错卦": "升"},
    {"本卦": "升", "互卦": "兑", "综卦": "萃", "错卦": "萃"},
    {"本卦": "困", "互卦": "大过", "综卦": "井", "错卦": "井"},
    {"本卦": "井", "互卦": "大过", "综卦": "困", "错卦": "困"},
    {"本卦": "革", "互卦": "夬", "综卦": "鼎", "错卦": "鼎"},
    {"本卦": "鼎", "互卦": "姤", "综卦": "革", "错卦": "革"},
    {"本卦": "震", "互卦": "坎", "综卦": "震", "错卦": "艮"},
    {"本卦": "艮", "互卦": "坎", "综卦": "艮", "错卦": "震"},
    {"本卦": "渐", "互卦": "既济", "综卦": "归妹", "错卦": "归妹"},
    {"本卦": "归妹", "互卦": "未济", "综卦": "渐", "错卦": "渐"},
    {"本卦": "丰", "互卦": "大过", "综卦": "旅", "错卦": "旅"},
    {"本卦": "旅", "互卦": "大过", "综卦": "丰", "错卦": "丰"},
    {"本卦": "巽", "互卦": "兑", "综卦": "巽", "错卦": "兑"},
    {"本卦": "兑", "互卦": "巽", "综卦": "兑", "错卦": "巽"},
    {"本卦": "涣", "互卦": "蹇", "综卦": "节", "错卦": "节"},
    {"本卦": "节", "互卦": "解", "综卦": "涣", "错卦": "涣"},
    {"本卦": "中孚", "互卦": "蹇", "综卦": "中孚", "错卦": "小过"},
    {"本卦": "小过", "互卦": "解", "综卦": "小过", "错卦": "中孚"},
    {"本卦": "既济", "互卦": "既济", "综卦": "未济", "错卦": "未济"},
    {"本卦": "未济", "互卦": "未济", "综卦": "既济", "错卦": "既济"}
];

// 更新卦象数据
const updatedHexagramsData = hexagramsData.map(hexagram => {
    // 根据fullName提取别名，例如"乾为天（乾卦）"的别名为"乾为天"
    const alias = hexagram.fullName.split('（')[0];
    
    // 从fullName提取卦名，例如"乾为天（乾卦）"的卦名为"乾"
    const name = hexagram.fullName.split('（')[1]?.replace('卦）', '') || hexagram.fullName;
    
    // 查找对应的互卦、综卦、错卦数据
    const relatedData = relatedHexagramsData.find(item => item.本卦 === name);
    
    if (relatedData) {
        return {
            ...hexagram,
            alias: alias,
            mutualHexagram: nameToIdMap[relatedData.互卦],
            reverseHexagram: nameToIdMap[relatedData.综卦],
            oppositeHexagram: nameToIdMap[relatedData.错卦]
        };
    }
    
    return {
        ...hexagram,
        alias: alias
    };
});

// 将更新后的数据写入文件
fs.writeFileSync('hexagramsFullData.json', JSON.stringify(updatedHexagramsData, null, 2), 'utf8');

console.log('卦象数据已成功更新！');
